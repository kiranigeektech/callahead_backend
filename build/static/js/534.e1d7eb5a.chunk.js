"use strict";(self.webpackChunktruck_tracking=self.webpackChunktruck_tracking||[]).push([[534],{1534:function(e,t,n){n.r(t),n.d(t,{default:function(){return v}});var s=n(885),r=n(2791),a=n(4270),i=n(2144),c=n(4849),o=n(8979),l=n(6871),u=n(2115),d=(n(3161),n(5483)),m=n.n(d),h=n(5543),p=(0,n(5856).io)("http://18.212.205.10:5000",{transports:["websocket"]}),f=n(4834),g=n(184);m().workerClass=n(9437).Z;var x=(0,u.ZP)({accessToken:"pk.eyJ1IjoiY2FsbGFoZWFkIiwiYSI6ImNsMXc2aDJueTBnZWIzam1wa29pNGozM2cifQ.TVMTneGJ2zs9WGZvarWLFA"}),v=function(){var e=(0,l.TH)(),t={id:"",name:""},n=(0,r.useState)(t),d=(0,s.Z)(n,2),m=d[0],v=d[1],j=(0,r.useState)(""),b=(0,s.Z)(j,2),k=b[0],_=b[1],N=(0,r.useState)([]),S=(0,s.Z)(N,2),Z=S[0],T=S[1],y=(0,r.useState)(null),I=(0,s.Z)(y,2),C=I[0],D=I[1],w=(0,r.useState)(null),J=(0,s.Z)(w,2),E=J[0],G=J[1],A=(0,r.useState)([]),F=(0,s.Z)(A,2),M=F[0],P=F[1],W=(0,r.useState)([]),z=(0,s.Z)(W,2),O=z[0],Y=z[1],B=(0,r.useState)(),H=(0,s.Z)(B,2),L=H[0],R=H[1],q=(0,r.useState)(!0),K=(0,s.Z)(q,2),Q=K[0],U=K[1];p.on("driverLocation/".concat(m.id),(function(e){G(e)})),(0,r.useEffect)((function(){E&&console.log("socketdata",E)}),[E]),(0,r.useEffect)((function(){if(e){var n=localStorage.getItem("driver_data"),s=JSON.parse(n);if(s){var r={id:s.ID,name:s.NAME};v(r)}}return function(){localStorage.removeItem("driver_data"),v(t)}}),[e]),(0,r.useEffect)((function(){var e=localStorage.getItem("auth");_(JSON.parse(e))}),[]),(0,r.useEffect)((function(){U(!0),null!==m&&void 0!==m&&m.id&&(0,h.iY)(k,m.id).then((function(e){var t=e.data.data,n=t.map((function(e){return[Number(e.customer.maplong),Number(e.customer.maplat),e.submited_route.status,e.submited_route.reason,e.submited_route.status,e.customer.siteaddr,e.customer.sitephone,e.customer.sitename,e.route.stopnum]})),s=t.map((function(e){return[Number(e.customer.maplong),Number(e.customer.maplat)]}));T(n),P(s),U(!1)}))}),[m.id]),(0,r.useEffect)((function(){null!==m&&void 0!==m&&m.id&&(0,h.HO)(k,m.id).then((function(e){var t=[e.data.data].map((function(e){return[null!==e&&void 0!==e&&e.lat?Number(e.lat):null,null!==e&&void 0!==e&&e.long?Number(e.long):null]}));Y(t)}))}),[m.id]);return(0,g.jsxs)(r.Fragment,{children:[(0,g.jsx)(a.q,{children:(0,g.jsx)("title",{children:"Truck Tracking | Dashboard | Track"})}),(0,g.jsx)(o.Z,{children:(0,g.jsxs)("div",{className:"Trackdriver",children:[(0,g.jsx)("div",{className:"Trackdriver__title",children:(0,g.jsxs)("div",{children:[" TRACKING ",">","  ",m.name," "]})}),(0,g.jsx)(i.Z,{className:"common_card",children:(0,g.jsx)("div",{className:"Trackdriver__map",children:Q?(0,g.jsx)("div",{className:"Trackdriver__map--spinner",children:(0,g.jsx)(c.Z,{animation:"border"})}):(0,g.jsxs)(x,{onStyleData:function(e){return e.setZoom(16)},style:"mapbox://styles/mapbox/streets-v9",center:L||(M&&M.length>0?M[0]:[72.8246169,21.2357561]),containerStyle:{height:"63vh",width:"100wh"},movingMethod:"flyTo",children:[Z.map((function(e,t){return(0,g.jsxs)("div",{children:[(0,g.jsx)(u.Jx,{style:{marginBottom:"40px"},coordinates:[e[0],e[1]],anchor:"bottom",children:(0,g.jsx)("div",{children:(0,g.jsx)("img",{className:"Trackdriver__map--mappin",src:e[2]?"Partially Completed"===e[2]?"/assets/image/partial-complete.png":"failed"===e[2]?"/assets/image/failed.png":"/assets/image/success.png":"/assets/image/customer-icon.png",onClick:function(t){t.preventDefault(),function(e,t){e.preventDefault(),D(t)}(t,e)}})})}),E?E&&(0,g.jsx)(u.Jx,{style:{padding:"0px 30px"},anchor:"bottom",coordinates:E&&E.is_online&&E.user_location&&E.user_location.length>1?[E.user_location[1],E.user_location[0]]:M[0],children:(0,g.jsx)("img",{className:"maptruck",style:{transform:"rotate(".concat((null===E||void 0===E?void 0:E.course)||0,"deg)")},src:"/assets/image/truck-icon.png"})}):O[0]&&(0,g.jsx)(u.Jx,{anchor:"bottom",coordinates:O&&O.length>0&&O[0].length>0&&O[0][1]&&O[0][0]&&"number"===typeof O[0][0]&&"number"===typeof O[0][1]?[O[0][1],O[0][0]]:M&&M.length>0?M[0]:[72.8246169,21.2357561],children:(0,g.jsx)("img",{className:"maptruck",src:"/assets/image/truck-icon.png"})})]},t)})),C&&(0,g.jsx)(u.GI,{anchor:"bottom",coordinates:[C[0],C[1]],offset:{"bottom-left":[12,-38],bottom:[0,-41],"bottom-right":[-12,-38]},children:(0,g.jsxs)("div",{className:"Popup",children:[(0,g.jsxs)("div",{className:"close",children:[(0,g.jsx)("div",{children:(0,g.jsx)("p",{children:null===C[3]?(0,g.jsx)("b",{children:"Pending"}):(0,g.jsx)("b",{children:C[4].charAt(0).toUpperCase()+C[4].slice(1)})})}),(0,g.jsx)("img",{src:"/assets/image/close.png",onClick:function(e){e.preventDefault(),function(e){e.preventDefault(),D(null)}(e)}})]}),(0,g.jsxs)("p",{children:[(0,g.jsx)("b",{children:"Site Name"}),"  : ",C[7]]}),(0,g.jsxs)("p",{children:[(0,g.jsx)("b",{children:"Address"}),"  : ",C[5]]}),(0,g.jsxs)("p",{children:[(0,g.jsx)("b",{children:"Reason"})," : ",C[3]," "]}),(0,g.jsxs)("p",{children:[(0,g.jsx)("b",{children:"Site Num"})," : ",C[6]]}),(0,g.jsxs)("p",{children:[(0,g.jsx)("b",{children:"Stop Num"})," : ",C[8]]})]})}),(0,g.jsx)("div",{className:"Trackdriver__navigateicon",onClick:function(){E&&E.is_online&&E.user_location&&E.user_location.length>1?R([E.user_location[1],E.user_location[0]]):O&&O.length>0&&O[0].length>0&&O[0][1]&&O[0][0]&&"number"===typeof O[0][0]&&"number"===typeof O[0][1]&&R([O[0][1],O[0][0]])},children:(0,g.jsx)(f.lD,{})})]})})})]})})]})}}}]);
//# sourceMappingURL=534.e1d7eb5a.chunk.js.map